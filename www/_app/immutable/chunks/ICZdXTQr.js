import{w as o}from"./DpXop7cd.js";import{K as E}from"./CIbqCY78.js";const I={matchStartedBy:null,lastGameHammerTeam:null,currentGameStartHammer:null,currentTwentyTeam:0,matchStartTime:null,currentMatchGames:[],currentMatchRounds:[],currentGameRounds:[]},g=o({team1:0,team2:0}),u=o(0),l=o(I),S=o(null),k=o(null),p=o(null),T=o(0),h=o(null),v=o([]),y=o([]),b=o([]);function D(){const t=localStorage.getItem("crokinoleMatchState");if(t)try{const a=JSON.parse(t);l.set(a),S.set(a.matchStartedBy),k.set(a.lastGameHammerTeam),p.set(a.currentGameStartHammer),T.set(a.currentTwentyTeam),h.set(a.matchStartTime),v.set(a.currentMatchGames),y.set(a.currentMatchRounds),b.set(a.currentGameRounds)}catch(a){console.error("Error loading match state:",a)}const e=localStorage.getItem("crokinoleRoundsPlayed");if(e)try{u.set(parseInt(e,10))}catch(a){console.error("Error loading rounds played:",a)}}function i(){l.subscribe(t=>{localStorage.setItem("crokinoleMatchState",JSON.stringify(t))})()}function j(){l.set(I),S.set(null),k.set(null),p.set(null),T.set(0),h.set(null),v.set([]),y.set([]),b.set([]),u.set(0),g.set({team1:0,team2:0}),i()}function O(t){b.update(e=>[...e,t]),y.update(e=>[...e,t]),l.update(e=>({...e,currentGameRounds:[...e.currentGameRounds,t],currentMatchRounds:[...e.currentMatchRounds,t]})),i()}function A(t,e){S.set(t),p.set(e),h.set(Date.now()),l.update(a=>({...a,matchStartedBy:t,currentGameStartHammer:e,matchStartTime:Date.now()})),i()}function C(t){T.set(t),l.update(e=>({...e,currentTwentyTeam:t})),i()}function x(t,e,a,s){u.update(H=>{const R=H+1;return localStorage.setItem("crokinoleRoundsPlayed",R.toString()),R});const N={roundNumber:E(u),team1Points:t,team2Points:e,team1Twenty:a,team2Twenty:s,timestamp:Date.now()};O(N),g.set({team1:t,team2:e})}const n={name:"",color:"#00ff88",points:0,rounds:0,autoRounds:0,matches:0,twenty:0,hasWon:!1,hasHammer:!1},r=o({...n,name:"Team 1",color:"#00ff88"}),c=o({...n,name:"Team 2",color:"#ff3366"});function F(){r.set({...n,name:"Team 1",color:"#00ff88"}),c.set({...n,name:"Team 2",color:"#ff3366"}),u.set(0),g.set({team1:0,team2:0}),localStorage.setItem("crokinoleRoundsPlayed","0"),d()}function w(t){if(!t||typeof t!="object")return!1;const e=t;return typeof e.name=="string"&&typeof e.color=="string"&&typeof e.points=="number"&&typeof e.rounds=="number"&&typeof e.twenty=="number"&&typeof e.hasWon=="boolean"&&typeof e.hasHammer=="boolean"}function K(){const t=localStorage.getItem("crokinoleTeam1"),e=localStorage.getItem("crokinoleTeam2");if(t)try{const a=JSON.parse(t);w(a)?r.set(a):(console.warn("Invalid team1 data in localStorage, using defaults"),r.set({...n,name:"Team 1",color:"#00ff88"}))}catch(a){console.error("Error loading team1:",a),r.set({...n,name:"Team 1",color:"#00ff88"})}if(e)try{const a=JSON.parse(e);w(a)?c.set(a):(console.warn("Invalid team2 data in localStorage, using defaults"),c.set({...n,name:"Team 2",color:"#ff3366"}))}catch(a){console.error("Error loading team2:",a),c.set({...n,name:"Team 2",color:"#ff3366"})}}function d(){r.subscribe(t=>{localStorage.setItem("crokinoleTeam1",JSON.stringify(t))})(),c.subscribe(t=>{localStorage.setItem("crokinoleTeam2",JSON.stringify(t))})()}function P(t,e){(t===1?r:c).update(s=>({...s,...e})),d()}function L(t,e){P(t,{points:Math.max(0,(t===1?M():G()).points+e)})}function M(){let t={...n};return r.subscribe(e=>t=e)(),t}function G(){let t={...n};return c.subscribe(e=>t=e)(),t}function U(){const t=M(),e=G();r.set(e),c.set(t),d()}function X(){const t=M(),e=G();r.update(a=>({...a,color:e.color})),c.update(a=>({...a,color:t.color})),d()}const J="2.0.0",f={appVersion:J,pointsToWin:7,timerMinutes:10,timerSeconds:0,language:"ca",matchesToWin:1,show20s:!1,showHammer:!1,gameType:"singles",gameMode:"rounds",roundsToPlay:4,eventTitle:"Scorekinole",matchPhase:"",historyBtnX:null,historyBtnY:null};function B(t){if(!t||typeof t!="object")return!1;const e=t;return typeof e.gameMode=="string"&&(e.gameMode==="points"||e.gameMode==="rounds")&&typeof e.pointsToWin=="number"&&typeof e.roundsToPlay=="number"&&typeof e.timerMinutes=="number"&&typeof e.timerSeconds=="number"&&typeof e.language=="string"}function V(){const{subscribe:t,set:e,update:a}=o(f);return{subscribe:t,set:e,update:a,load:()=>{const s=localStorage.getItem("crokinoleGame");if(s)try{const m=JSON.parse(s);B(m)?e(m):(console.warn("Invalid settings in localStorage, using defaults"),e(f))}catch(m){console.error("Error loading settings:",m),e(f)}},save:()=>{a(s=>(localStorage.setItem("crokinoleGame",JSON.stringify(s)),s))}}}const Y=V();export{D as a,X as b,j as c,c as d,L as e,C as f,Y as g,d as h,A as i,g as j,x as k,K as l,l as m,u as n,p as o,F as r,U as s,r as t,P as u};
