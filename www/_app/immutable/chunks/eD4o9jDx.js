import{w as n}from"./C__xTf-N.js";import{W as M}from"./DRj0A6O8.js";const m=n(null),h=n([]),S=n([]),z=n("current");function L(){try{const e=localStorage.getItem("crokinoleMatchHistory");if(e){const o=JSON.parse(e);h.set(o)}const t=localStorage.getItem("crokinoleDeletedMatches");if(t){const o=JSON.parse(t);S.set(o)}const a=localStorage.getItem("crokinoleCurrentMatch");if(a){const o=JSON.parse(a);m.set(o)}}catch(e){console.error("Error loading history:",e)}}function b(){m.subscribe(e=>{e?localStorage.setItem("crokinoleCurrentMatch",JSON.stringify(e)):localStorage.removeItem("crokinoleCurrentMatch")})()}function W(e){h.update(t=>{const o=[e,...t].slice(0,50);return localStorage.setItem("crokinoleMatchHistory",JSON.stringify(o)),o})}function U(e){let t=null;h.update(a=>{const o=a.find(c=>c.id===e);o&&(t=o);const s=a.filter(c=>c.id!==e);return localStorage.setItem("crokinoleMatchHistory",JSON.stringify(s)),s}),t&&S.update(a=>{const o=[t,...a];return localStorage.setItem("crokinoleDeletedMatches",JSON.stringify(o)),o})}function X(e){let t=null;S.update(a=>{const o=a.find(c=>c.id===e);o&&(t=o);const s=a.filter(c=>c.id!==e);return localStorage.setItem("crokinoleDeletedMatches",JSON.stringify(s)),s}),t&&h.update(a=>{const o=[t,...a];return localStorage.setItem("crokinoleMatchHistory",JSON.stringify(o)),o})}function Y(e){S.update(t=>{const a=t.filter(o=>o.id!==e);return localStorage.setItem("crokinoleDeletedMatches",JSON.stringify(a)),a})}function K(){h.set([]),localStorage.removeItem("crokinoleMatchHistory")}function Q(){S.set([]),localStorage.removeItem("crokinoleDeletedMatches")}function Z(){const e={startTime:Date.now(),games:[],rounds:[]};m.set(e),b()}function ee(e){const t=M(m),a=t?t.startTime:Date.now(),o=Date.now(),s=o-a,c={...e,id:`match_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,startTime:a,endTime:o,duration:s};W(c),m.set(null),b()}const P={matchStartedBy:null,lastGameHammerTeam:null,currentGameStartHammer:null,currentTwentyTeam:0,twentyDialogPending:!1,matchStartTime:null,currentMatchGames:[],currentMatchRounds:[],currentGameRounds:[]},g=n({team1:0,team2:0}),d=n(0),u=n(P),w=n(null),C=n(null),I=n(null),k=n(0),H=n(!1),G=n(null),E=n([]),v=n([]),p=n([]);function te(){const e=localStorage.getItem("crokinoleMatchState");if(e)try{const a=JSON.parse(e);u.set(a),w.set(a.matchStartedBy??null),C.set(a.lastGameHammerTeam??null),I.set(a.currentGameStartHammer??null),k.set(a.currentTwentyTeam??0),H.set(a.twentyDialogPending??!1),G.set(a.matchStartTime??null),E.set(a.currentMatchGames??[]),v.set(a.currentMatchRounds??[]),p.set(a.currentGameRounds??[])}catch(a){console.error("Error loading match state:",a)}const t=localStorage.getItem("crokinoleRoundsPlayed");if(t)try{d.set(parseInt(t,10))}catch(a){console.error("Error loading rounds played:",a)}}function f(){u.subscribe(e=>{localStorage.setItem("crokinoleMatchState",JSON.stringify(e))})()}function ae(){u.set(P),w.set(null),C.set(null),I.set(null),k.set(0),H.set(!1),G.set(null),E.set([]),v.set([]),p.set([]),d.set(0),g.set({team1:0,team2:0}),f()}function oe(){p.set([]),d.set(0),g.set({team1:0,team2:0}),u.update(e=>({...e,currentGameRounds:[]})),f()}function V(e){p.update(t=>[...t,e]),v.update(t=>[...t,e]),u.update(t=>({...t,currentGameRounds:[...t.currentGameRounds,e],currentMatchRounds:[...t.currentMatchRounds,e]})),f()}function ne(e,t){w.set(e),I.set(t),G.set(Date.now()),u.update(a=>({...a,matchStartedBy:e,currentGameStartHammer:t,matchStartTime:Date.now()})),f()}function se(e){k.set(e),u.update(t=>({...t,currentTwentyTeam:e})),f()}function re(e){H.set(e),u.update(t=>({...t,twentyDialogPending:e})),f()}function ce(e,t,a,o){d.update(_=>{const O=_+1;return localStorage.setItem("crokinoleRoundsPlayed",O.toString()),O});const s=M(d),c={roundNumber:s,team1Points:e,team2Points:t,team1Twenty:a,team2Twenty:o,timestamp:Date.now()};V(c);const N=M(g);g.set({team1:N.team1+e,team2:N.team2+t}),A(e,t,s)}function A(e,t,a){m.update(o=>{if(!o)return o;const s={team1Points:e,team2Points:t,roundNumber:a};return{...o,rounds:[...o.rounds,s]}}),b()}const r={name:"",color:"#00ff88",points:0,rounds:0,autoRounds:0,matches:0,twenty:0,hasWon:!1,hasHammer:!1},l=n({...r,name:"Team 1",color:"#00ff88"}),i=n({...r,name:"Team 2",color:"#ff3366"});function le(){let e={...r},t={...r};l.subscribe(a=>e=a)(),i.subscribe(a=>t=a)(),l.set({...r,name:e.name||"Team 1",color:e.color||"#00ff88",hasHammer:e.hasHammer}),i.set({...r,name:t.name||"Team 2",color:t.color||"#ff3366",hasHammer:t.hasHammer}),d.set(0),g.set({team1:0,team2:0}),localStorage.setItem("crokinoleRoundsPlayed","0"),y()}function J(e){if(!e||typeof e!="object")return!1;const t=e;return typeof t.name=="string"&&typeof t.color=="string"&&typeof t.points=="number"&&typeof t.rounds=="number"&&typeof t.twenty=="number"&&typeof t.hasWon=="boolean"&&typeof t.hasHammer=="boolean"}function ie(){const e=localStorage.getItem("crokinoleTeam1"),t=localStorage.getItem("crokinoleTeam2");if(e)try{const a=JSON.parse(e);J(a)?l.set(a):(console.warn("Invalid team1 data in localStorage, using defaults"),l.set({...r,name:"Team 1",color:"#00ff88"}))}catch(a){console.error("Error loading team1:",a),l.set({...r,name:"Team 1",color:"#00ff88"})}if(t)try{const a=JSON.parse(t);J(a)?i.set(a):(console.warn("Invalid team2 data in localStorage, using defaults"),i.set({...r,name:"Team 2",color:"#ff3366"}))}catch(a){console.error("Error loading team2:",a),i.set({...r,name:"Team 2",color:"#ff3366"})}}function y(){l.subscribe(e=>{localStorage.setItem("crokinoleTeam1",JSON.stringify(e))})(),i.subscribe(e=>{localStorage.setItem("crokinoleTeam2",JSON.stringify(e))})()}function B(e,t){(e===1?l:i).update(o=>({...o,...t})),y()}function ue(e,t){B(e,{points:Math.max(0,(e===1?R():D()).points+t)})}function R(){let e={...r};return l.subscribe(t=>e=t)(),e}function D(){let e={...r};return i.subscribe(t=>e=t)(),e}function me(){const e=R(),t=D();l.set(t),i.set(e),y()}function de(){const e=R(),t=D();l.update(a=>({...a,color:t.color})),i.update(a=>({...a,color:e.color})),y()}const j="2.0.0",T={appVersion:j,pointsToWin:7,timerMinutes:10,timerSeconds:0,language:"ca",matchesToWin:1,show20s:!1,showHammer:!1,gameType:"singles",gameMode:"rounds",roundsToPlay:4,eventTitle:"Scorekinole",matchPhase:"",timerX:null,timerY:null};function x(e){if(!e||typeof e!="object")return!1;const t=e;return typeof t.gameMode=="string"&&(t.gameMode==="points"||t.gameMode==="rounds")&&typeof t.pointsToWin=="number"&&typeof t.roundsToPlay=="number"&&typeof t.timerMinutes=="number"&&typeof t.timerSeconds=="number"&&typeof t.language=="string"}function F(){const{subscribe:e,set:t,update:a}=n(T);return{subscribe:e,set:t,update:a,load:()=>{const o=localStorage.getItem("crokinoleGame");if(o)try{const s=JSON.parse(o);x(s)?t(s):(console.warn("Invalid settings in localStorage, using defaults"),t(T))}catch(s){console.error("Error loading settings:",s),t(T)}},save:()=>{a(o=>(localStorage.setItem("crokinoleGame",JSON.stringify(o)),o))}}}const fe=F();export{Y as A,K as B,Q as C,h as D,S as E,oe as F,re as G,p as H,H as I,te as a,L as b,de as c,ae as d,i as e,ue as f,fe as g,se as h,y as i,ne as j,ce as k,ie as l,u as m,g as n,d as o,m as p,Z as q,le as r,me as s,l as t,B as u,E as v,ee as w,z as x,U as y,X as z};
